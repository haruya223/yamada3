<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>CDæ›²é †ç¶­æŒãƒ»åˆ†å‰²ãƒ„ãƒ¼ãƒ«ï¼ˆæ”¹è‰¯ç‰ˆï¼‰</title>
    <style>
        body { font-family: sans-serif; max-width: 800px; margin: 20px auto; background: #f8f9fa; padding: 20px; color: #333; }
        .card { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        textarea { width: 100%; height: 120px; margin: 10px 0; padding: 10px; border: 1px solid #ddd; border-radius: 6px; font-family: monospace; box-sizing: border-box; }
        .controls { display: flex; gap: 15px; align-items: center; margin-bottom: 20px; background: #eee; padding: 15px; border-radius: 8px; }
        select { padding: 8px; border-radius: 4px; border: 1px solid #ccc; font-size: 16px; }
        button { background: #007bff; color: white; border: none; padding: 10px 25px; border-radius: 6px; cursor: pointer; font-weight: bold; font-size: 16px; }
        button:hover { background: #0056b3; }
        .result-title { margin-top: 25px; padding-bottom: 10px; border-bottom: 2px solid #007bff; }
        .disk-box { background: #fff; border: 1px solid #e0e0e0; margin-bottom: 15px; border-radius: 8px; overflow: hidden; }
        .disk-header { background: #f1f3f5; padding: 10px 15px; font-weight: bold; display: flex; justify-content: space-between; border-bottom: 1px solid #e0e0e0; }
        .song-list { padding: 10px 15px; font-size: 0.9em; line-height: 1.6; color: #444; word-break: break-all; }
        .target-info { font-size: 0.9em; color: #666; margin-bottom: 15px; padding: 10px; background: #fffde7; border-left: 4px solid #fbc02d; }
    </style>
</head>
<body>

<div class="card">
    <h2>ğŸ’¿ CDæ›²é †ç¶­æŒãƒ»åˆ†å‰²ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼</h2>
    <p>æ›²é †ã‚’å¤‰ãˆãšã«ã€å„ãƒ‡ã‚£ã‚¹ã‚¯ã®æ™‚é–“ã‚’ã§ãã‚‹ã ã‘å‡ç­‰ã«ã—ã¾ã™ã€‚</p>
    
    <label>æ›²ã®æ™‚é–“ã‚’å…¥åŠ›ï¼ˆä¾‹: 3:54, 2:54...ï¼‰</label>
    <textarea id="timeInput" placeholder="3:54, 2:54, 3:17..."></textarea>
    
    <div class="controls">
        <label>åˆ†å‰²æšæ•°:</label>
        <select id="diskCount">
            <option value="2">2æšçµ„</option>
            <option value="3">3æšçµ„</option>
            <option value="4">4æšçµ„</option>
            <option value="5">5æšçµ„</option>
        </select>
        <button type="button" onclick="calculateSplit()">åˆ†å‰²ãƒã‚¤ãƒ³ãƒˆã‚’è¨ˆç®—</button>
    </div>

    <div id="resultArea"></div>
</div>

<script>
// æ™‚é–“ã®æ–‡å­—åˆ—ï¼ˆ3:54ãªã©ï¼‰ã‚’ç§’æ•°ã«å¤‰æ›
function timeToSec(t) {
    if (!t) return null;
    // å…¨è§’ã‚³ãƒ­ãƒ³ã‚’åŠè§’ã«å¤‰æ›ã—ã€æ•°å­—ã¨ã‚³ãƒ­ãƒ³ä»¥å¤–ã‚’é™¤å»
    const cleanT = t.replace(/ï¼š/g, ':').replace(/[^0-9:]/g, '');
    const p = cleanT.split(':');
    if (p.length < 2) return null;
    return parseInt(p[0], 10) * 60 + parseInt(p[1], 10);
}

// ç§’æ•°ã‚’æ™‚é–“ã®æ–‡å­—åˆ—ï¼ˆ3:54ï¼‰ã«å¤‰æ›
function secToTime(s) {
    const m = Math.floor(s / 60);
    const sec = s % 60;
    return m + ":" + sec.toString().padStart(2, '0');
}

function calculateSplit() {
    const inputArea = document.getElementById('timeInput');
    const resultArea = document.getElementById('resultArea');
    const numDisks = parseInt(document.getElementById('diskCount').value);

    // ã‚«ãƒ³ãƒã€æ”¹è¡Œã€ã‚¹ãƒšãƒ¼ã‚¹ãªã©ã§åˆ†å‰²ã—ã¦é…åˆ—ã«ã™ã‚‹
    const rawTimes = inputArea.value.split(/[,\n\sã€]/);
    const songs = rawTimes.map(timeToSec).filter(s => s !== null);
    
    if (songs.length === 0) {
        alert("æœ‰åŠ¹ãªæ™‚é–“ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚ã€Œ3:54, 2:54ã€ã®ã‚ˆã†ã«å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");
        return;
    }

    const totalSec = songs.reduce((a, b) => a + b, 0);
    const targetPerDisk = totalSec / numDisks;
    
    let disks = [];
    let currentSongIndex = 0;

    for (let d = 0; d < numDisks; d++) {
        let currentDiskSongs = [];
        let currentDiskTotal = 0;
        
        if (d < numDisks - 1) {
            // æ¬¡ã®æ›²ã‚’åŠ ãˆãŸã»ã†ãŒç›®æ¨™ã«è¿‘ã„ã‹ã€ä»Šã®æ–¹ãŒè¿‘ã„ã‹ã‚’åˆ¤å®šã—ã¦ãƒ«ãƒ¼ãƒ—
            while (currentSongIndex < songs.length) {
                let song = songs[currentSongIndex];
                let currentDiff = Math.abs(currentDiskTotal - targetPerDisk);
                let nextDiff = Math.abs((currentDiskTotal + song) - targetPerDisk);
                
                // æ¬¡ã®æ›²ã‚’è¶³ã—ãŸã»ã†ãŒç›®æ¨™å€¤ã«è¿‘ã„ãªã‚‰è¿½åŠ ã€ãã†ã§ãªã‘ã‚Œã°ã“ã®ãƒ‡ã‚£ã‚¹ã‚¯ã¯çµ‚äº†
                // ãŸã ã—ã€1æ›²ã‚‚å…¥ã£ã¦ã„ãªã„å ´åˆã¯å¿…ãšå…¥ã‚Œã‚‹
                if (currentDiskSongs.length === 0 || nextDiff < currentDiff) {
                    currentDiskTotal += song;
                    currentDiskSongs.push(song);
                    currentSongIndex++;
                } else {
                    break;
                }
                
                // æ®‹ã‚Šã®æšæ•°ã«å¯¾ã—ã¦æ›²ãŒè¶³ã‚Šãªããªã‚‹ã®ã‚’é˜²ã
                if (songs.length - currentSongIndex < numDisks - (d + 1)) {
                    break;
                }
            }
        } else {
            // æœ€å¾Œã®ãƒ‡ã‚£ã‚¹ã‚¯ã«æ®‹ã‚Šã‚’å…¨éƒ¨å…¥ã‚Œã‚‹
            while (currentSongIndex < songs.length) {
                currentDiskTotal += songs[currentSongIndex];
                currentDiskSongs.push(songs[currentSongIndex]);
                currentSongIndex++;
            }
        }
        disks.push({ total: currentDiskTotal, items: currentDiskSongs });
    }

    // çµæœè¡¨ç¤º
    let html = `<h3 class="result-title">è¨ˆç®—çµæœ</h3>`;
    html += `<div class="target-info">å…¨ä½“åˆè¨ˆ: <strong>${secToTime(totalSec)}</strong><br>1æšã‚ãŸã‚Šã®ç›®æ¨™: <strong>${secToTime(Math.round(targetPerDisk))}</strong></div>`;
    
    disks.forEach((disk, i) => {
        html += `
            <div class="disk-box">
                <div class="disk-header">
                    <span>Disc ${i+1} (${disk.items.length}æ›²)</span>
                    <span>è¨ˆ ${secToTime(disk.total)}</span>
                </div>
                <div class="song-list">
                    ${disk.items.map(s => secToTime(s)).join(' | ')}
                </div>
            </div>
        `;
    });
    
    resultArea.innerHTML = html;
}
</script>
</body>
</html>
